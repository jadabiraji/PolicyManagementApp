# Policy Management API – Backend Documentation (ASP.NET Core)

This is the backend for the Policy Management App built with ASP.NET Core. It uses Entity Framework Core for data access, follows the repository pattern, supports JWT authentication, and exposes RESTful endpoints for user login and policy management.

---

## Project Structure

PolicyManagement.API/
├── Controllers/
│   ├── AuthController.cs               # Handles login endpoint and JWT auth
│   ├── PoliciesController.cs           # CRUD operations for policies
│   └── PolicyTypesController.cs        # Get available policy types
│
├── Data/
│   ├── Entities/
│   │   ├── Policy.cs                   # Policy entity
│   │   └── PolicyType.cs               # Policy type entity
│   │
│   ├── Interfaces/
│   │   └── IPolicyRepository.cs        # Repository interface
│   │
│   ├── Repositories/
│   │   ├── PolicyRepository.cs         # Repository implementation
│   │   ├── PolicyDbContext.cs          # EF Core DbContext
│   │   └── PolicyDbContextFactory.cs   # Used for migrations
│
├── Migrations/                         # EF Core migration files
│
├── Models/
│   ├── JwtSettings.cs                  # JWT configuration settings
│   ├── LoginRequest.cs                 # Model for login input
│   └── LoginResponse.cs                # JWT + user response
│
├── Services/
│   └── AuthService.cs                  # Generates JWT tokens
│
├── appsettings.json                    # App config
├── appsettings.Development.json        # Dev-specific overrides
├── PolicyManagement.API.csproj         # Project file
├── PolicyManagement.API.http           # Test HTTP requests
├── Program.cs                          # App startup configuration

---

## Authentication

- Uses JWT-based authentication
- Token is generated by AuthService.cs and returned via LoginResponse
- Token is stored as an HttpOnly cookie on the frontend
- All protected endpoints use [Authorize] attribute
- JwtSettings.cs binds secret, issuer, and expiry config from appsettings.json

---

## Core Concepts

- Repository Pattern: Clean separation of data access logic via IPolicyRepository and PolicyRepository
- EF Core: Handles DB access via PolicyDbContext
- Migrations: Use Add-Migration and Update-Database to sync DB
- Modular API: Controllers split by domain (Auth, Policies, PolicyTypes)

---

## Run the API Locally

1. Make sure appsettings.json contains a valid DB connection string
2. Run the backend:

   dotnet run

The API will be available at:

   `http://localhost:5067`

---

## API Documentation (Swagger)

Swagger is enabled for live interactive API docs.

After running the project, open:

   `http://localhost:5067/swagger/index.html`

This page will let you:
- See all available API endpoints
- View request/response schemas
- Test the API live from your browser

---

## Key Files Overview

File                            | Purpose
-------------------------------|------------------------------------------------
AuthController.cs              | Handles login and JWT issuing
PoliciesController.cs          | GET/POST/PUT/DELETE for policies
PolicyTypesController.cs       | Fetches static policy types
Policy.cs                      | Entity model for a policy
PolicyType.cs                  | Entity model for a policy type
LoginRequest.cs                | User login input
LoginResponse.cs               | JWT + metadata returned to client
AuthService.cs                 | Generates tokens, handles auth logic
PolicyDbContext.cs             | EF Core DB context setup
PolicyRepository.cs            | Data logic for managing policies
PolicyDbContextFactory.cs      | Required for EF Core CLI migration tools
Program.cs                     | Main app entry, adds services & middlewares

---

## Future Enhancements

- Add role-based authorization (e.g. Admin/User)
- Audit logging for policy changes
- Unit tests for services and controllers
- Global exception handler middleware
- Better error response model with codes
